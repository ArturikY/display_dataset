<!DOCTYPE html>
<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç–∞-—Å–µ—Ç–∞</title>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
		<style>
			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
					Oxygen, Ubuntu, Cantarell, sans-serif;
				margin: 0;
				padding: 20px;
				background-color: #f8f9fa;
				color: #333;
			}

			h1 {
				text-align: center;
				color: #2c3e50;
				margin-bottom: 30px;
				font-weight: 300;
			}

			#loading {
				text-align: center;
				font-size: 18px;
				color: #6c757d;
				margin: 50px 0;
			}

			#error {
				text-align: center;
				font-size: 16px;
				margin: 50px 0;
			}

			table {
				width: 100%;
				margin: 0;
				border-collapse: collapse;
				background-color: white;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
				border-radius: 8px;
				overflow: hidden;
			}

			th {
				background-color: #34495e;
				color: white;
				padding: 15px 20px 24px 20px;
				text-align: center;
				font-weight: 500;
				font-size: 14px;
				text-transform: uppercase;
				letter-spacing: 0.5px;
				cursor: pointer;
				user-select: none;
				position: relative;
				transition: background-color 0.2s ease;
			}

			th:hover {
				background-color: #2c3e50;
			}

			th.sortable::after {
				content: '‚Üï';
				opacity: 0.5;
				font-size: 10px;
				position: absolute;
				bottom: 8px;
				left: 50%;
				transform: translateX(-50%);
			}

			th.sort-asc::after {
				content: '‚Üë';
				opacity: 1;
				font-size: 10px;
				position: absolute;
				bottom: 6px;
				left: 50%;
				transform: translateX(-50%);
			}

			th.sort-desc::after {
				content: '‚Üì';
				opacity: 1;
				font-size: 10px;
				position: absolute;
				bottom: 6px;
				left: 50%;
				transform: translateX(-50%);
			}

			/* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ */
			.highlight {
				background-color: #fff3cd;
				padding: 2px 4px;
				border-radius: 3px;
				font-weight: bold;
			}

			.search-match {
				background-color: #d4edda;
				border-left: 3px solid #28a745;
			}

			.no-results {
				text-align: center;
				padding: 40px;
				color: #6c757d;
				font-style: italic;
			}

			td {
				padding: 12px 20px;
				border-bottom: 1px solid #e9ecef;
				font-size: 14px;
			}

			tr:nth-child(even) {
				background-color: #f8f9fa;
			}

			tr:nth-child(odd) {
				background-color: white;
			}

			tr:hover {
				background-color: #e3f2fd;
				transition: background-color 0.2s ease;
			}

			th:first-child,
			td:first-child {
				text-align: center;
				width: 60px;
			}

			th:last-child,
			td:last-child {
				text-align: center;
				width: 120px;
			}

			/* –°—Ç–∏–ª–∏ –¥–ª—è –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞ */
			#totalRowsSelect {
				position: relative !important;
				z-index: 9999 !important;
			}

			/* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ —Å –≤—ã–ø–∞–¥–∞—é—â–∏–º —Å–ø–∏—Å–∫–æ–º */
			.header-controls {
				position: relative;
				z-index: 9998;
				overflow: visible !important;
			}

			/* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã */
			.table-container {
				width: 100%;
				overflow-x: auto;
				-webkit-overflow-scrolling: touch;
			}

			/* –£–±–∏—Ä–∞–µ–º overflow —Ç–æ–ª—å–∫–æ —Ç–∞–º, –≥–¥–µ –Ω—É–∂–Ω–æ */
			body {
				overflow-x: auto;
				overflow-y: auto;
			}

			/* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ —ç–∫—Ä–∞–Ω–∞ */
			
			/* –î–ª—è –ø–ª–∞–Ω—à–µ—Ç–æ–≤ –∏ –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
			@media (max-width: 768px) {
				body {
					padding: 10px;
				}
				
				th, td {
					padding: 10px 8px 18px 8px;
					font-size: 12px;
				}
				
				th {
					font-size: 11px;
					letter-spacing: 0.3px;
				}
				
				table {
					min-width: 800px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
				}
			}

			/* –î–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
			@media (max-width: 480px) {
				body {
					padding: 5px;
				}
				
				th, td {
					padding: 8px 6px 16px 6px;
					font-size: 11px;
				}
				
				th {
					font-size: 10px;
					letter-spacing: 0.2px;
				}
				
				table {
					min-width: 600px; /* –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ */
				}
				
				/* –£–º–µ–Ω—å—à–∞–µ–º –æ—Ç—Å—Ç—É–ø—ã –∑–∞–≥–æ–ª–æ–≤–∫–∞ */
				h1 {
					font-size: 18px;
					margin-bottom: 15px;
				}
			}

			@media print {
				body {
					background-color: white;
					padding: 0;
					margin: 0;
				}

				h1 {
					display: none !important;
				}

				#totalRowsSelect {
					display: none !important;
				}

				#pagination {
					display: none !important;
				}

				#printBtn {
					display: none !important;
				}

				#uploadBtn {
					display: none !important;
				}

				#searchPanel {
					display: none !important;
				}

				#filterPanel {
					display: none !important;
				}

				.table-container {
					overflow: visible !important;
				}

				table {
					box-shadow: none;
					border: 1px solid #000;
					width: 100% !important;
					margin: 0 !important;
					min-width: auto !important;
				}

				th {
					background-color: #34495e !important;
					color: white !important;
					border: 1px solid #000;
					padding: 8px !important;
					font-size: 12px !important;
					text-align: center !important;
				}

				td {
					border: 1px solid #000;
					padding: 6px !important;
					font-size: 11px !important;
				}

				tr:nth-child(even) {
					background-color: #f8f9fa !important;
				}

				tr:nth-child(odd) {
					background-color: white !important;
				}

				@page {
					size: A4;
					margin: 1cm;
				}
			}
		</style>
	</head>
	<body>
		<div
			style="
				display: flex;
				justify-content: space-between;
				align-items: center;
				margin-bottom: 30px;
				position: relative;
				z-index: 1;
				overflow: visible;
			"
		>
			<h1 style="margin: 0">–û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–∞—Ç–∞-—Å–µ—Ç–∞</h1>
			<div
				class="header-controls"
				style="display: flex; gap: 15px; align-items: center"
			>
				<select
					id="totalRowsSelect"
					style="
						padding: 10px 15px;
						border: 2px solid #34495e;
						border-radius: 6px;
						font-size: 14px;
						background-color: white;
						color: #333;
						cursor: pointer;
						display: none;
						position: relative;
						z-index: 9999;
					"
					onchange="changeTotalRows()"
				>
					<option value="10">10 –∑–∞–ø–∏—Å–µ–π</option>
					<option value="20">20 –∑–∞–ø–∏—Å–µ–π</option>
					<option value="50">50 –∑–∞–ø–∏—Å–µ–π</option>
					<option value="100">100 –∑–∞–ø–∏—Å–µ–π</option>
					<option value="all">–í—Å–µ –∑–∞–ø–∏—Å–∏</option>
				</select>

				<!-- –°–∫—Ä—ã—Ç—ã–π input –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ -->
				<input
					type="file"
					id="fileInput"
					accept=".xlsx,.xls"
					style="display: none"
					onchange="handleFileUpload(event)"
				/>

				<!-- –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–Ω–æ–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞ -->
				<button
					id="uploadBtn"
					onclick="document.getElementById('fileInput').click()"
					style="
						background-color: #28a745;
						color: white;
						border: none;
						padding: 12px 24px;
						border-radius: 6px;
						font-size: 14px;
						font-weight: 500;
						cursor: pointer;
						transition: background-color 0.2s ease;
						display: none;
					"
					onmouseover="this.style.backgroundColor='#218838'"
					onmouseout="this.style.backgroundColor='#28a745'"
				>
					üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É
				</button>

				<button
					id="printBtn"
					onclick="window.print()"
					style="
						background-color: #34495e;
						color: white;
						border: none;
						padding: 12px 24px;
						border-radius: 6px;
						font-size: 14px;
						font-weight: 500;
						cursor: pointer;
						transition: background-color 0.2s ease;
						display: none;
					"
					onmouseover="this.style.backgroundColor='#2c3e50'"
					onmouseout="this.style.backgroundColor='#34495e'"
				>
					üñ®Ô∏è –ü–µ—á–∞—Ç—å
				</button>
			</div>
		</div>

		<!-- –ü–∞–Ω–µ–ª—å –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ -->
		<div
			id="searchPanel"
			style="
				display: none;
				margin-bottom: 30px;
				background: white;
				padding: 20px;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			"
		>
			<div style="margin-bottom: 15px">
				<label
					style="
						display: block;
						margin-bottom: 5px;
						font-weight: 500;
						color: #2c3e50;
					"
					>üîç –ü–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –∫–æ–ª–æ–Ω–∫–∞–º:</label
				>
				<input
					type="text"
					id="globalSearch"
					placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞..."
					style="
						width: 100%;
						padding: 12px 15px;
						border: 2px solid #e9ecef;
						border-radius: 6px;
						font-size: 14px;
						box-sizing: border-box;
						transition: border-color 0.2s ease;
					"
					oninput="performGlobalSearch()"
					onfocus="this.style.borderColor='#34495e'"
					onblur="this.style.borderColor='#e9ecef'"
				/>
			</div>
		</div>

		<!-- –ü–∞–Ω–µ–ª—å —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
		<div
			id="filterPanel"
			style="
				display: none;
				margin-bottom: 30px;
				background: white;
				padding: 20px;
				border-radius: 8px;
				box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			"
		>
			<div style="margin-bottom: 15px">
				<label
					style="
						display: block;
						margin-bottom: 10px;
						font-weight: 500;
						color: #2c3e50;
						font-size: 16px;
					"
					>üéõÔ∏è –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã:</label
				>
				<div
					style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap"
				>
					<button
						id="filterNumeric"
						onclick="applyFilter('numeric')"
						style="
							background-color: #17a2b8;
							color: white;
							border: none;
							padding: 10px 16px;
							border-radius: 6px;
							font-size: 14px;
							cursor: pointer;
							transition: background-color 0.2s ease;
						"
						onmouseover="this.style.backgroundColor='#138496'"
						onmouseout="this.style.backgroundColor='#17a2b8'"
					>
						üî¢ –¢–æ–ª—å–∫–æ —á–∏—Å–ª–æ–≤—ã–µ
					</button>

					<button
						id="filterText"
						onclick="applyFilter('text')"
						style="
							background-color: #6f42c1;
							color: white;
							border: none;
							padding: 10px 16px;
							border-radius: 6px;
							font-size: 14px;
							cursor: pointer;
							transition: background-color 0.2s ease;
						"
						onmouseover="this.style.backgroundColor='#5a32a3'"
						onmouseout="this.style.backgroundColor='#6f42c1'"
					>
						üìù –¢–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ
					</button>

					<button
						id="filterComplete"
						onclick="applyFilter('complete')"
						style="
							background-color: #28a745;
							color: white;
							border: none;
							padding: 10px 16px;
							border-radius: 6px;
							font-size: 14px;
							cursor: pointer;
							transition: background-color 0.2s ease;
						"
						onmouseover="this.style.backgroundColor='#218838'"
						onmouseout="this.style.backgroundColor='#28a745'"
					>
						‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ
					</button>

					<button
						id="filterIncomplete"
						onclick="applyFilter('incomplete')"
						style="
							background-color: #fd7e14;
							color: white;
							border: none;
							padding: 10px 16px;
							border-radius: 6px;
							font-size: 14px;
							cursor: pointer;
							transition: background-color 0.2s ease;
						"
						onmouseover="this.style.backgroundColor='#e8650e'"
						onmouseout="this.style.backgroundColor='#fd7e14'"
					>
						‚ö†Ô∏è –° –ø—É—Å—Ç—ã–º–∏ –ø–æ–ª—è–º–∏
					</button>

					<button
						id="clearFilters"
						onclick="clearAllFilters()"
						style="
							background-color: #6c757d;
							color: white;
							border: none;
							padding: 10px 16px;
							border-radius: 6px;
							font-size: 14px;
							cursor: pointer;
							transition: background-color 0.2s ease;
						"
						onmouseover="this.style.backgroundColor='#5a6268'"
						onmouseout="this.style.backgroundColor='#6c757d'"
					>
						üóëÔ∏è –°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã
					</button>
				</div>
			</div>
		</div>

		<div id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</div>

		<div class="table-container">
			<table id="stopsTable" style="display: none">
				<thead id="stopsTableHead">
					<tr id="stopsHeaderRow"></tr>
				</thead>
				<tbody id="stopsTableBody"></tbody>
			</table>
		</div>

		<div
			id="pagination"
			style="
				display: none;
				justify-content: center;
				align-items: center;
				gap: 10px;
				margin-top: 30px;
				padding: 20px;
			"
		>
			<button
				id="firstPage"
				onclick="goToPage(1)"
				style="
					padding: 8px 12px;
					border: 1px solid #34495e;
					background-color: white;
					color: #34495e;
					border-radius: 4px;
					cursor: pointer;
					font-size: 14px;
				"
			>
				¬´¬´
			</button>

			<button
				id="prevPage"
				onclick="goToPage(currentPage - 1)"
				style="
					padding: 8px 12px;
					border: 1px solid #34495e;
					background-color: white;
					color: #34495e;
					border-radius: 4px;
					cursor: pointer;
					font-size: 14px;
				"
			>
				¬´
			</button>

			<div
				id="pageNumbers"
				style="display: flex; gap: 5px; align-items: center"
			></div>

			<button
				id="nextPage"
				onclick="goToPage(currentPage + 1)"
				style="
					padding: 8px 12px;
					border: 1px solid #34495e;
					background-color: white;
					color: #34495e;
					border-radius: 4px;
					cursor: pointer;
					font-size: 14px;
				"
			>
				¬ª
			</button>

			<button
				id="lastPage"
				onclick="goToPage(totalPages)"
				style="
					padding: 8px 12px;
					border: 1px solid #34495e;
					background-color: white;
					color: #34495e;
					border-radius: 4px;
					cursor: pointer;
					font-size: 14px;
				"
			>
				¬ª¬ª
			</button>
		</div>

		<div id="error" style="display: none; color: red">
			–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö
		</div>

		<script>
			// –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
			let allData = []
			let headers = []
			let currentPage = 1
			let totalPages = 1
			let recordsPerPage = 10
			let displayedData = [] // –î–∞–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è –Ω–∞ —Å–∞–π—Ç–µ
			let dataLoaded = false // –§–ª–∞–≥ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏

			// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
			let currentSortColumn = -1
			let currentSortDirection = 'asc' // 'asc' –∏–ª–∏ 'desc'

			// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
			let filteredData = [] // –û—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
			let currentSearchTerm = ''
			let currentSearchColumn = -1 // -1 –æ–∑–Ω–∞—á–∞–µ—Ç –ø–æ–∏—Å–∫ –ø–æ –≤—Å–µ–º –∫–æ–ª–æ–Ω–∫–∞–º
			let searchResults = [] // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π

			// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤
			let activeFilters = [] // –ú–∞—Å—Å–∏–≤ –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
			let columnAnalysis = [] // –ê–Ω–∞–ª–∏–∑ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–ª–æ–Ω–∫–∞—Ö
			function analyzeColumnTypes(data) {
				if (!data || data.length === 0) return []

				return headers.map((header, index) => {
					const columnData = data
						.map(row => row[index])
						.filter(val => val !== undefined && val !== null && val !== '')

					let numericCount = 0
					let textCount = 0
					let emptyCount = data.length - columnData.length

					columnData.forEach(val => {
						const strVal = String(val).trim()
						if (strVal === '') {
							emptyCount++
						} else if (
							!isNaN(parseFloat(strVal)) &&
							isFinite(parseFloat(strVal))
						) {
							numericCount++
						} else {
							textCount++
						}
					})

					const totalNonEmpty = columnData.length
					const numericRatio =
						totalNonEmpty > 0 ? numericCount / totalNonEmpty : 0
					const textRatio = totalNonEmpty > 0 ? textCount / totalNonEmpty : 0

					let type = 'mixed'
					if (numericRatio > 0.8) type = 'numeric'
					else if (textRatio > 0.8) type = 'text'

					return {
						name: header,
						index: index,
						type: type,
						numericCount: numericCount,
						textCount: textCount,
						emptyCount: emptyCount,
						totalCount: data.length,
						avgLength:
							totalNonEmpty > 0
								? columnData.reduce((sum, val) => sum + String(val).length, 0) /
								  totalNonEmpty
								: 0,
					}
				})
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞
			function applyFilter(filterType) {
				// –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ñ–∏–ª—å—Ç—Ä (–¥–æ–±–∞–≤–ª—è–µ–º –∏–ª–∏ —É–±–∏—Ä–∞–µ–º)
				const filterIndex = activeFilters.indexOf(filterType)
				if (filterIndex > -1) {
					// –§–∏–ª—å—Ç—Ä —É–∂–µ –∞–∫—Ç–∏–≤–µ–Ω - —É–±–∏—Ä–∞–µ–º –µ–≥–æ
					activeFilters.splice(filterIndex, 1)
				} else {
					// –§–∏–ª—å—Ç—Ä –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω - –¥–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ
					activeFilters.push(filterType)
				}

				// –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ —Å –Ω–æ–≤—ã–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
				if (currentSearchTerm) {
					performGlobalSearch()
					return
				}

				// –ï—Å–ª–∏ –ø–æ–∏—Å–∫–∞ –Ω–µ—Ç, –ø—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∫ –∏—Å—Ö–æ–¥–Ω—ã–º –¥–∞–Ω–Ω—ã–º
				applyActiveFilters()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
			function applyActiveFilters() {
				let baseData = allData

				// –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
				activeFilters.forEach(filterType => {
					switch (filterType) {
						case 'numeric':
							baseData = filterNumericData(baseData)
							break
						case 'text':
							baseData = filterTextData(baseData)
							break
						case 'complete':
							baseData = filterCompleteRecords(baseData)
							break
						case 'incomplete':
							baseData = filterIncompleteRecords(baseData)
							break
					}
				})

				displayedData = baseData

				// –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã
				updateFilterButtons()

				// –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º
				applyCurrentSortAndDisplay()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —á–∏—Å–ª–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
			function filterNumericData(data) {
				return data.filter(row => {
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤ —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
					let hasNumeric = false
					let hasNonEmpty = false

					for (let cell of row) {
						if (cell !== undefined && cell !== null && cell !== '') {
							hasNonEmpty = true
							const strVal = String(cell).trim()
							if (
								strVal !== '' &&
								!isNaN(parseFloat(strVal)) &&
								isFinite(parseFloat(strVal))
							) {
								hasNumeric = true
							}
						}
					}

					// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —á–∏—Å–ª–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
					// –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Ö –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å)
					return hasNumeric || !hasNonEmpty
				})
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
			function filterTextData(data) {
				return data.filter(row => {
					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –≤ —Å—Ç—Ä–æ–∫–µ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
					let hasText = false
					let hasNonEmpty = false

					for (let cell of row) {
						if (cell !== undefined && cell !== null && cell !== '') {
							hasNonEmpty = true
							const strVal = String(cell).trim()
							if (
								strVal !== '' &&
								(isNaN(parseFloat(strVal)) || !isFinite(parseFloat(strVal)))
							) {
								hasText = true
							}
						}
					}

					// –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –∏–º–µ—é—Ç —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
					// –∏–ª–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ –∏—Ö –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å)
					return hasText || !hasNonEmpty
				})
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
			function filterCompleteRecords(data) {
				return data.filter(row =>
					row.every(cell => cell !== undefined && cell !== null && cell !== '')
				)
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –∑–∞–ø–∏—Å–µ–π —Å –ø—É—Å—Ç—ã–º–∏ –ø–æ–ª—è–º–∏
			function filterIncompleteRecords(data) {
				return data.filter(row =>
					row.some(cell => cell === undefined || cell === null || cell === '')
				)
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
			function clearFilters() {
				activeFilters = []

				// –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∏—Å–∫, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º –µ–≥–æ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–∞
				if (currentSearchTerm) {
					performGlobalSearch()
					return
				}

				// –ï—Å–ª–∏ –ø–æ–∏—Å–∫–∞ –Ω–µ—Ç, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
				displayedData = allData.slice()
				updateFilterButtons()
				applyCurrentSortAndDisplay()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ –∫–Ω–æ–ø–æ–∫ —Ñ–∏–ª—å—Ç—Ä–æ–≤
			function updateFilterButtons() {
				const buttons = {
					numeric: document.getElementById('filterNumeric'),
					text: document.getElementById('filterText'),
					complete: document.getElementById('filterComplete'),
					incomplete: document.getElementById('filterIncomplete'),
				}

				// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –≤ –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
				Object.values(buttons).forEach(button => {
					if (button) {
						button.style.opacity = '0.7'
						button.style.boxShadow = 'none'
					}
				})

				// –í—ã–¥–µ–ª—è–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
				activeFilters.forEach(filterType => {
					if (buttons[filterType]) {
						const activeButton = buttons[filterType]
						activeButton.style.opacity = '1'
						activeButton.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.3)'
					}
				})
			}

			// –ê–ª–≥–æ—Ä–∏—Ç–º –ë–æ–π–µ—Ä–∞-–ú—É—Ä–∞ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫
			class BoyerMooreSearch {
				constructor(pattern) {
					this.pattern = pattern.toLowerCase()
					this.patternLength = this.pattern.length
					this.badCharTable = this.buildBadCharTable()
					this.goodSuffixTable = this.buildGoodSuffixTable()
				}

				// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã –ø–ª–æ—Ö–∏—Ö —Å–∏–º–≤–æ–ª–æ–≤
				buildBadCharTable() {
					const table = {}
					for (let i = 0; i < this.patternLength; i++) {
						table[this.pattern[i]] = this.patternLength - 1 - i
					}
					return table
				}

				// –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã —Ö–æ—Ä–æ—à–∏—Ö —Å—É—Ñ—Ñ–∏–∫—Å–æ–≤ (—É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
				buildGoodSuffixTable() {
					const table = new Array(this.patternLength).fill(0)
					let lastPrefixPosition = this.patternLength

					for (let i = this.patternLength - 1; i >= 0; i--) {
						if (this.isPrefix(i + 1)) {
							lastPrefixPosition = i + 1
						}
						table[this.patternLength - 1 - i] =
							lastPrefixPosition - i + this.patternLength - 1
					}

					for (let i = 0; i < this.patternLength - 1; i++) {
						const suffixLength = this.suffixLength(i)
						table[suffixLength] = this.patternLength - 1 - i + suffixLength
					}

					return table
				}

				isPrefix(pos) {
					for (let i = pos, j = 0; i < this.patternLength; i++, j++) {
						if (this.pattern[i] !== this.pattern[j]) {
							return false
						}
					}
					return true
				}

				suffixLength(pos) {
					let length = 0
					for (
						let i = pos, j = this.patternLength - 1;
						i >= 0 && this.pattern[i] === this.pattern[j];
						i--, j--
					) {
						length++
					}
					return length
				}

				// –û—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ç–æ–¥ –ø–æ–∏—Å–∫–∞
				search(text) {
					const textLower = text.toLowerCase()
					const textLength = textLower.length
					const results = []

					if (this.patternLength === 0) {
						return results
					}

					let i = 0
					while (i <= textLength - this.patternLength) {
						let j = this.patternLength - 1

						// –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å–ø—Ä–∞–≤–∞ –Ω–∞–ª–µ–≤–æ
						while (j >= 0 && this.pattern[j] === textLower[i + j]) {
							j--
						}

						if (j < 0) {
							// –ù–∞–π–¥–µ–Ω–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
							results.push({
								start: i,
								end: i + this.patternLength,
								text: text.substring(i, i + this.patternLength),
							})
							i += this.goodSuffixTable[0]
						} else {
							// –°–¥–≤–∏–≥–∞–µ–º—Å—è –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ
							const badCharShift =
								this.badCharTable[textLower[i + j]] || this.patternLength
							const goodSuffixShift =
								this.goodSuffixTable[this.patternLength - 1 - j]
							i += Math.max(badCharShift, goodSuffixShift)
						}
					}

					return results
				}

				// –ü–æ–∏—Å–∫ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
				searchWithHighlight(text) {
					const matches = this.search(text)
					if (matches.length === 0) {
						return text
					}

					let result = ''
					let lastIndex = 0

					matches.forEach(match => {
						result += text.substring(lastIndex, match.start)
						result += `<span class="highlight">${text.substring(
							match.start,
							match.end
						)}</span>`
						lastIndex = match.end
					})

					result += text.substring(lastIndex)
					return result
				}
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ –≤—Å–µ–º –∫–æ–ª–æ–Ω–∫–∞–º
			function performGlobalSearch() {
				const searchTerm = document.getElementById('globalSearch').value.trim()
				currentSearchTerm = searchTerm
				currentSearchColumn = -1

				if (searchTerm === '') {
					clearSearch()
					return
				}

				// –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –ø–æ–∏—Å–∫–æ–≤–∏–∫–∞ –ë–æ–π–µ—Ä–∞-–ú—É—Ä–∞
				const searcher = new BoyerMooreSearch(searchTerm)

				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ (—Å —É—á–µ—Ç–æ–º –∞–∫—Ç–∏–≤–Ω—ã—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤)
				let baseData = allData
				if (activeFilters.length > 0) {
					// –ü—Ä–∏–º–µ–Ω—è–µ–º –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
					activeFilters.forEach(filterType => {
						switch (filterType) {
							case 'numeric':
								baseData = filterNumericData(baseData)
								break
							case 'text':
								baseData = filterTextData(baseData)
								break
							case 'complete':
								baseData = filterCompleteRecords(baseData)
								break
							case 'incomplete':
								baseData = filterIncompleteRecords(baseData)
								break
						}
					})
				}

				// –ò—â–µ–º —Å—Ä–µ–¥–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
				filteredData = baseData.filter(row => {
					return row.some(cell => {
						const cellValue = String(cell || '').toLowerCase()
						return searcher.search(cellValue).length > 0
					})
				})

				// –°–æ–∑–¥–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π
				searchResults = filteredData.map(row => {
					return row.map(cell => {
						const cellValue = String(cell || '')
						return searcher.searchWithHighlight(cellValue)
					})
				})

				// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã–µ –¥–∞–Ω–Ω—ã–µ
				displayedData = filteredData
				updateFilterButtons()
				applyCurrentSortAndDisplay()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –ø–æ–∏—Å–∫–∞
			function clearSearch() {
				filteredData = []
				searchResults = []
				currentSearchTerm = ''
				document.getElementById('globalSearch').value = ''

				// –ï—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã, –ø—Ä–∏–º–µ–Ω—è–µ–º –∏—Ö –∫ –∏—Å—Ö–æ–¥–Ω—ã–º –¥–∞–Ω–Ω—ã–º
				if (activeFilters.length > 0) {
					applyActiveFilters()
				} else {
					displayedData = allData.slice()
				}

				updateFilterButtons()
				applyCurrentSortAndDisplay()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—á–∏—Å—Ç–∫–∏ –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
			function clearAllFilters() {
				clearSearch()
				clearFilters()
				currentSortColumn = -1
				currentSortDirection = 'asc'
				updateSortIndicators()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–∏—Å–∫–∞ (—É–¥–∞–ª–µ–Ω–∞)
			function updateSearchStats() {
				// –§—É–Ω–∫—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
			function applyCurrentSortAndDisplay() {
				if (currentSortColumn >= 0) {
					sortData(currentSortColumn, currentSortDirection)
				}
				displayCurrentPage()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
			async function handleFileUpload(event) {
				const file = event.target.files[0]

				if (!file) {
					return
				}

				// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–∏–ø–∞ —Ñ–∞–π–ª–∞
				const allowedTypes = [
					'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet', // .xlsx
					'application/vnd.ms-excel', // .xls
				]

				if (
					!allowedTypes.includes(file.type) &&
					!file.name.match(/\.(xlsx|xls)$/i)
				) {
					alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª Excel (.xlsx –∏–ª–∏ .xls)')
					event.target.value = '' // –û—á–∏—â–∞–µ–º input
					return
				}

				// –í–∞–ª–∏–¥–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–∞ (–º–∞–∫—Å–∏–º—É–º 10MB)
				const maxSize = 10 * 1024 * 1024 // 10MB
				if (file.size > maxSize) {
					alert('–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä: 10MB')
					event.target.value = ''
					return
				}

				try {
					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
					document.getElementById('loading').style.display = 'block'
					document.getElementById('stopsTable').style.display = 'none'
					document.getElementById('searchPanel').style.display = 'none'
					document.getElementById('totalRowsSelect').style.display = 'none'
					document.getElementById('uploadBtn').style.display = 'none'
					document.getElementById('printBtn').style.display = 'none'
					document.getElementById('pagination').style.display = 'none'

					// –ß–∏—Ç–∞–µ–º —Ñ–∞–π–ª
					const arrayBuffer = await file.arrayBuffer()
					const workbook = XLSX.read(arrayBuffer, { type: 'array' })

					// –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Å—Ç–∞
					const firstSheetName = workbook.SheetNames[0]
					const worksheet = workbook.Sheets[firstSheetName]

					// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º Excel –¥–∞–Ω–Ω—ã–µ –≤ –º–∞—Å—Å–∏–≤ –º–∞—Å—Å–∏–≤–æ–≤
					const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 })

					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —Ñ–∞–π–ª –Ω–µ –ø—É—Å—Ç–æ–π
					if (data.length === 0) {
						throw new Error('–§–∞–π–ª –ø—É—Å—Ç –∏–ª–∏ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö')
					}

					// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–∫–∏
					headers = data[0] || []
					const rows = data.slice(1)

					// –§–∏–ª—å—Ç—Ä—É–µ–º –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏
					const processedData = rows.filter(row =>
						row.some(cell => cell !== undefined && cell !== null && cell !== '')
					)

					if (processedData.length === 0) {
						throw new Error('–í —Ñ–∞–π–ª–µ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è')
					}

					// –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
					allData = processedData
					
					// –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–∏—Å–∫–∞, —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
					clearSearch()
					clearFilters()
					currentSortColumn = -1
					currentSortDirection = 'asc'
					
					// –°–±—Ä–∞—Å—ã–≤–∞–µ–º select –∫ –∑–Ω–∞—á–µ–Ω–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
					document.getElementById('totalRowsSelect').value = '10'
					recordsPerPage = 10

					// –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Ç–∞–±–ª–∏—Ü—ã
					const headerRowEl = document.getElementById('stopsHeaderRow')
					headerRowEl.innerHTML = ''
					headers.forEach((headerText, index) => {
						const th = document.createElement('th')
						th.textContent = headerText === undefined ? '' : String(headerText)
						th.onclick = () => handleHeaderClick(index)
						th.classList.add('sortable')
						headerRowEl.appendChild(th)
					})

					// –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –ø–∞–≥–∏–Ω–∞—Ü–∏—é –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö
					totalPages = Math.ceil(allData.length / recordsPerPage)
					currentPage = 1

					// –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
					document.getElementById('loading').style.display = 'none'
					document.getElementById('searchPanel').style.display = 'block'
					document.getElementById('stopsTable').style.display = 'table'
					document.getElementById('totalRowsSelect').style.display = 'block'
					document.getElementById('uploadBtn').style.display = 'block'
					document.getElementById('printBtn').style.display = 'block'
					document.getElementById('pagination').style.display = 'flex'

					// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
					columnAnalysis = analyzeColumnTypes(allData)
					updateFilterButtons()

					// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
					updateSortIndicators()

					// –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è 10 –∑–∞–ø–∏—Å–µ–π
					changeTotalRows()

					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–µ
					console.log(
						`–§–∞–π–ª "${file.name}" —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω. –ó–∞–ø–∏—Å–µ–π: ${allData.length}`
					)
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Ñ–∞–π–ª–∞:', error)

					// –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
					document.getElementById('loading').style.display = 'none'

					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
					document.getElementById('error').style.display = 'block'
					document.getElementById(
						'error'
					).textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ${error.message}`

					// –û—á–∏—â–∞–µ–º input
					event.target.value = ''
				}
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö
			function sortData(columnIndex, direction) {
				if (columnIndex < 0 || columnIndex >= headers.length) {
					return
				}

				displayedData.sort((a, b) => {
					const aValue = a[columnIndex] !== undefined ? a[columnIndex] : ''
					const bValue = b[columnIndex] !== undefined ? b[columnIndex] : ''

					// –ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è—é—Ç—Å—è –ª–∏ –∑–Ω–∞—á–µ–Ω–∏—è —á–∏—Å–ª–∞–º–∏
					const aNum = parseFloat(aValue)
					const bNum = parseFloat(bValue)
					const isNumeric =
						!isNaN(aNum) && !isNaN(bNum) && isFinite(aNum) && isFinite(bNum)

					let comparison = 0

					if (isNumeric) {
						// –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —á–∏—Å–µ–ª
						comparison = aNum - bNum
					} else {
						// –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫
						const aStr = String(aValue).toLowerCase()
						const bStr = String(bValue).toLowerCase()
						comparison = aStr.localeCompare(bStr, 'ru')
					}

					return direction === 'asc' ? comparison : -comparison
				})

				// –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –ø–æ—Å–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
				totalPages = Math.ceil(displayedData.length / recordsPerPage)

				// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ—Å–ª–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
				currentPage = 1
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –ø–æ –∑–∞–≥–æ–ª–æ–≤–∫—É
			function handleHeaderClick(columnIndex) {
				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
				if (currentSortColumn === columnIndex) {
					// –ï—Å–ª–∏ –∫–ª–∏–∫–∞–µ–º –ø–æ —Ç–æ–π –∂–µ –∫–æ–ª–æ–Ω–∫–µ, –º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
					if (currentSortDirection === 'asc') {
						currentSortDirection = 'desc'
					} else if (currentSortDirection === 'desc') {
						// –¢—Ä–µ—Ç–∏–π –∫–ª–∏–∫ - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É
						currentSortColumn = -1
						currentSortDirection = 'asc'
					}
				} else {
					// –ï—Å–ª–∏ –∫–ª–∏–∫–∞–µ–º –ø–æ –Ω–æ–≤–æ–π –∫–æ–ª–æ–Ω–∫–µ, –Ω–∞—á–∏–Ω–∞–µ–º —Å –≤–æ–∑—Ä–∞—Å—Ç–∞—é—â–µ–π —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
					currentSortDirection = 'asc'
					currentSortColumn = columnIndex
				}

				// –°–æ—Ä—Ç–∏—Ä—É–µ–º –¥–∞–Ω–Ω—ã–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
				if (currentSortColumn >= 0) {
					sortData(currentSortColumn, currentSortDirection)
				} else {
					// –ï—Å–ª–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–±—Ä–æ—à–µ–Ω–∞, –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —Å —É—á–µ—Ç–æ–º —Ñ–∏–ª—å—Ç—Ä–æ–≤
					if (currentSearchTerm) {
						// –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–∏—Å–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞
						displayedData = filteredData.slice()
					} else if (activeFilters.length > 0) {
						// –ï—Å–ª–∏ –µ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã, –ø—Ä–∏–º–µ–Ω—è–µ–º –∏—Ö
						applyActiveFilters()
						return // applyActiveFilters —É–∂–µ –≤—ã–∑–æ–≤–µ—Ç displayCurrentPage
					} else {
						// –ï—Å–ª–∏ –Ω–µ—Ç –Ω–∏ –ø–æ–∏—Å–∫–∞, –Ω–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
						displayedData = allData.slice()
					}
				}

				// –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
				updateSortIndicators()

				// –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
				displayCurrentPage()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–∏–∑—É–∞–ª—å–Ω—ã—Ö –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
			function updateSortIndicators() {
				const headerCells = document.querySelectorAll('#stopsHeaderRow th')

				headerCells.forEach((cell, index) => {
					// –£–±–∏—Ä–∞–µ–º –≤—Å–µ –∫–ª–∞—Å—Å—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
					cell.classList.remove('sortable', 'sort-asc', 'sort-desc')

					if (index === currentSortColumn && currentSortColumn >= 0) {
						// –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–ª–∞—Å—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω–æ–π –∫–æ–ª–æ–Ω–∫–∏
						cell.classList.add(`sort-${currentSortDirection}`)
					} else {
						// –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è —Å–æ—Ä—Ç–∏—Ä—É–µ–º—ã—Ö –∫–æ–ª–æ–Ω–æ–∫
						cell.classList.add('sortable')
					}
				})
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
			function displayCurrentPage() {
				const startIndex = (currentPage - 1) * recordsPerPage
				const endIndex = startIndex + recordsPerPage
				const recordsToShow = displayedData.slice(startIndex, endIndex)

				// –û—á–∏—â–∞–µ–º —Ç–∞–±–ª–∏—Ü—É
				const tableBody = document.getElementById('stopsTableBody')
				tableBody.innerHTML = ''

				// –ï—Å–ª–∏ –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
				if (displayedData.length === 0 && currentSearchTerm) {
					const row = document.createElement('tr')
					const cell = document.createElement('td')
					cell.colSpan = headers.length
					cell.className = 'no-results'
					cell.textContent = '–ü–æ –≤–∞—à–µ–º—É –∑–∞–ø—Ä–æ—Å—É –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ'
					row.appendChild(cell)
					tableBody.appendChild(row)
				} else {
					// –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –¥–∞–Ω–Ω—ã–º–∏ —Ç–µ–∫—É—â–µ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
					recordsToShow.forEach((record, recordIndex) => {
						const row = document.createElement('tr')

						// –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è —Å—Ç—Ä–æ–∫ —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –ø–æ–∏—Å–∫–∞
						if (currentSearchTerm) {
							row.className = 'search-match'
						}

						for (let colIndex = 0; colIndex < headers.length; colIndex++) {
							const cell = document.createElement('td')
							const value =
								record[colIndex] !== undefined ? record[colIndex] : ''

							// –ï—Å–ª–∏ –µ—Å—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∏—Ö
							if (
								searchResults.length > 0 &&
								searchResults[startIndex + recordIndex]
							) {
								const highlightedValue =
									searchResults[startIndex + recordIndex][colIndex]
								cell.innerHTML = highlightedValue
							} else {
								cell.textContent = value
							}

							row.appendChild(cell)
						}
						tableBody.appendChild(row)
					})
				}

				// –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
				updatePaginationButtons()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
			function updatePaginationInfo() {
				// –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –±–æ–ª—å—à–µ –Ω–µ –Ω—É–∂–Ω–∞, —Ç–∞–∫ –∫–∞–∫ –º—ã —É–±—Ä–∞–ª–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –∑–∞–ø–∏—Å—è—Ö
				// –û—Å—Ç–∞–≤–ª—è–µ–º –ø—É—Å—Ç–æ–π –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–Ω–æ–ø–æ–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
			function updatePaginationButtons() {
				const pageNumbers = document.getElementById('pageNumbers')
				pageNumbers.innerHTML = ''

				// –í—ã—á–∏—Å–ª—è–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
				let startPage = Math.max(1, currentPage - 2)
				let endPage = Math.min(totalPages, currentPage + 2)

				// –ï—Å–ª–∏ –º—ã –≤ –Ω–∞—á–∞–ª–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–ª—å—à–µ —Å—Ç—Ä–∞–Ω–∏—Ü —Å–ø—Ä–∞–≤–∞
				if (currentPage <= 3) {
					endPage = Math.min(totalPages, 5)
				}

				// –ï—Å–ª–∏ –º—ã –≤ –∫–æ–Ω—Ü–µ, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –±–æ–ª—å—à–µ —Å—Ç—Ä–∞–Ω–∏—Ü —Å–ª–µ–≤–∞
				if (currentPage > totalPages - 3) {
					startPage = Math.max(1, totalPages - 4)
				}

				// –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–º–µ—Ä–∞ —Å—Ç—Ä–∞–Ω–∏—Ü
				for (let i = startPage; i <= endPage; i++) {
					const pageBtn = document.createElement('button')
					pageBtn.textContent = i
					pageBtn.onclick = () => goToPage(i)
					pageBtn.style.cssText = `
                    padding: 8px 12px;
                    border: 1px solid #34495e;
                    background-color: ${
											i === currentPage ? '#34495e' : 'white'
										};
                    color: ${i === currentPage ? 'white' : '#34495e'};
                    border-radius: 4px;
                    cursor: pointer;
                    font-size: 14px;
                    font-weight: ${i === currentPage ? 'bold' : 'normal'};
                `
					pageNumbers.appendChild(pageBtn)
				}

				// –£–±–∏—Ä–∞–µ–º –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ - –æ–Ω–∏ –≤—Å–µ–≥–¥–∞ –æ—Å—Ç–∞—é—Ç—Å—è –∞–∫—Ç–∏–≤–Ω—ã–º–∏
				// –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤–æ, –Ω–æ —Ñ—É–Ω–∫—Ü–∏—è goToPage —Å–∞–º–∞ –ø—Ä–æ–≤–µ—Ä–∏—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ—Ö–æ–¥–∞
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
			function goToPage(page) {
				if (page >= 1 && page <= totalPages && page !== currentPage) {
					currentPage = page
					displayCurrentPage()
				}
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ–±—â–µ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º—ã—Ö –∑–∞–ø–∏—Å–µ–π
			function changeTotalRows() {
				const select = document.getElementById('totalRowsSelect')
				const selectedValue = select.value

				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
				// –ï—Å–ª–∏ –µ—Å—Ç—å –ø–æ–∏—Å–∫, –∏—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ñ–∏–ª—å—Ç—Ä—ã —É–∂–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –≤ –ø–æ–∏—Å–∫–µ)
				// –ï—Å–ª–∏ –ø–æ–∏—Å–∫–∞ –Ω–µ—Ç, –Ω–æ –µ—Å—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã, –ø—Ä–∏–º–µ–Ω—è–µ–º –∏—Ö
				let baseData
				if (currentSearchTerm) {
					baseData = filteredData
				} else if (activeFilters.length > 0) {
					// –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä—ã —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
					baseData = allData
					activeFilters.forEach(filterType => {
						switch (filterType) {
							case 'numeric':
								baseData = filterNumericData(baseData)
								break
							case 'text':
								baseData = filterTextData(baseData)
								break
							case 'complete':
								baseData = filterCompleteRecords(baseData)
								break
							case 'incomplete':
								baseData = filterIncompleteRecords(baseData)
								break
						}
					})
				} else {
					baseData = allData
				}

				// –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
				if (selectedValue === 'all') {
					displayedData = baseData.slice() // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –º–∞—Å—Å–∏–≤–∞
				} else {
					const totalRows = parseInt(selectedValue)
					displayedData = baseData.slice(0, totalRows)
				}

				// –ü—Ä–∏–º–µ–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫—É, –µ—Å–ª–∏ –æ–Ω–∞ –µ—Å—Ç—å
				if (currentSortColumn >= 0) {
					sortData(currentSortColumn, currentSortDirection)
				}

				// –ü–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
				totalPages = Math.ceil(displayedData.length / recordsPerPage)

				// –°–±—Ä–∞—Å—ã–≤–∞–µ–º –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
				currentPage = 1

				// –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
				updateFilterButtons()
				displayCurrentPage()
			}

			// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Excel —Ñ–∞–π–ª–∞
			async function loadAndDisplayData() {
				// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –ª–∏ —É–∂–µ –¥–∞–Ω–Ω—ã–µ
				if (dataLoaded) {
					console.log('–î–∞–Ω–Ω—ã–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º –ø–æ–≤—Ç–æ—Ä–Ω—É—é –∑–∞–≥—Ä—É–∑–∫—É')
					return
				}

				try {
					const response = await fetch('data1.xlsx')

					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`)
					}

					const arrayBuffer = await response.arrayBuffer()
					const workbook = XLSX.read(arrayBuffer, { type: 'array' })

					// –ü–æ–ª—É—á–∞–µ–º –∏–º—è –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Å—Ç–∞
					const firstSheetName = workbook.SheetNames[0]
					const worksheet = workbook.Sheets[firstSheetName]

					// –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º Excel –¥–∞–Ω–Ω—ã–µ –≤ –º–∞—Å—Å–∏–≤ –º–∞—Å—Å–∏–≤–æ–≤ (–∫–∞–∫ –µ—Å—Ç—å)
					const data = XLSX.utils.sheet_to_json(worksheet, { header: 1 })

					// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É –∫–∞–∫ –∑–∞–≥–æ–ª–æ–≤–∫–∏ (–∫–∞–∫ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ)
					headers = data[0] || []
					const rows = data.slice(1)

					// –î–∞–Ω–Ω—ã–µ –æ—Å—Ç–∞–≤–ª—è–µ–º –≤ –∏—Å—Ö–æ–¥–Ω–æ–º –≤–∏–¥–µ (–º–∞—Å—Å–∏–≤—ã)
					const processedData = rows

					// –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
					document.getElementById('loading').style.display = 'none'

					// –§–æ—Ä–º–∏—Ä—É–µ–º —à–∞–ø–∫—É —Ç–∞–±–ª–∏—Ü—ã —Å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞–º–∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
					const headerRowEl = document.getElementById('stopsHeaderRow')
					headerRowEl.innerHTML = ''
					headers.forEach((headerText, index) => {
						const th = document.createElement('th')
						th.textContent = headerText === undefined ? '' : String(headerText)
						th.onclick = () => handleHeaderClick(index)
						th.classList.add('sortable')
						headerRowEl.appendChild(th)
					})

					// –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é
					allData = processedData

					// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 10 –∑–∞–ø–∏—Å–µ–π (–∏–ª–∏ –º–µ–Ω—å—à–µ)
					displayedData = allData.slice(0, 10)
					
					// –£–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ select —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
					document.getElementById('totalRowsSelect').value = '10'

					// –í—ã—á–∏—Å–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
					totalPages = Math.ceil(displayedData.length / recordsPerPage)

					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –≤—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
					document.getElementById('searchPanel').style.display = 'block'
					document.getElementById('filterPanel').style.display = 'block'
					document.getElementById('stopsTable').style.display = 'table'
					document.getElementById('totalRowsSelect').style.display = 'block'
					document.getElementById('uploadBtn').style.display = 'block'
					document.getElementById('pagination').style.display = 'flex'
					document.getElementById('printBtn').style.display = 'block'

					// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∞–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
					columnAnalysis = analyzeColumnTypes(allData)
					updateFilterButtons()

					// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
					updateSortIndicators()

					// –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–µ—Ä–≤—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
					displayCurrentPage()

					// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ–ª–∞–≥, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã
					dataLoaded = true
				} catch (error) {
					console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö:', error)

					// –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
					document.getElementById('loading').style.display = 'none'

					// –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
					document.getElementById('error').style.display = 'block'
					document.getElementById(
						'error'
					).textContent = `–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö: ${error.message}`
				}
			}

			// –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
			document.addEventListener('DOMContentLoaded', loadAndDisplayData)
		</script>
	</body>
</html>
